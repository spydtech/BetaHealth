<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seller Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <link rel="shortcut icon" href="static/favicon_io/favicon.ico" type="image/x-icon">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            color: #007bff;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            max-height: 100vh; /* Prevent body from exceeding viewport */
            overflow-x: hidden;
        }

        /* Main wrapper to contain content */
        .main-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0; /* Allow shrinking */
        }

        /* Add to your CSS section */
        .table-danger td {
            background-color: #f8d7da; /* Light red for out of stock */
        }
        .table-warning td {
            background-color: #fff3cd; /* Light yellow for low stock */
        }
        .badge {
            font-size: 0.85em;
            padding: 0.35em 0.65em;
        }

        /* Seller navbar styling - matching admin style */
        .seller-navbar {
            background: #2c3e50 !important;
            border-bottom: 1px solid #1a252f;
            padding: 10px 0;
            flex-shrink: 0; /* Prevent navbar from shrinking */
        }
        
        .seller-navbar-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
        }
        
        .seller-navbar-logo a {
            display: flex;
            align-items: center;
        }
        
        .header-image {
            width: 160px;
            height: auto;
            padding: 5px;
        }
        
        .seller-navbar-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .seller-navbar-actions span,
        .seller-navbar-actions a {
            color: #fff !important;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }
        
        .seller-navbar-actions a:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .role-badge {
            background-color: #f39c12;
            color: #2c3e50;
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 12px;
            margin-left: 8px;
        }

        .btn-primary {
            background-color: #ffb902ff;
            color: #0d3056ff;
            border-color: #ffb902ff;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 5px;
            transition: background-color 0.2s ease;
        }

        .btn-primary:hover {
            background-color: #ffb902ff;
            border-color: rgb(231, 167, 6);
        }

        /* Content container */
        .content-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto; /* Allow scrolling if content is too long */
            min-height: 0; /* Allow shrinking */
        }

        /* Sidebar button styling */
        .sidebar-btn {
            width: 100%;
            text-align: left;
            border: none;
            background: transparent;
            color: #fff;
            padding: 12px 20px;
            margin-bottom: 5px;
            border-radius: 5px;
            transition: all 0.3s ease;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: #fff;
            transform: translateX(5px);
        }

        .sidebar-btn.active {
            background-color: #ffb902ff;
            color: #0d3056ff;
            font-weight: 600;
        }

        .sidebar-btn i {
            width: 20px;
            text-align: center;
        }

        /* Content section styling */
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .content-section.active {
            display: block;
        }
       

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Footer styling - stays at bottom of viewport */
        footer {
            background: #0d3056ff;
            color: white;
            font-size: 14px;
            border-top: 2px solid white;
            flex-shrink: 0; /* Prevent footer from shrinking */
            /* Remove margin-top: auto as it pushes footer too far down */
        }

        footer a {
            color: rgb(11, 228, 228);
            text-decoration: none;
        }

        footer a:hover {
            color: lightblue;
        }

        .footer__copyright {
            border-top: 1px solid #444;
            padding: 5px 0;
            font-size: 13px;
            text-align: center;
        }

        .policies li {
            display: inline-flex;
            justify-content: center;
            align-items: center;
        }

        .policies li::before {
            content: "\b7";
            padding: 0.8rem;
        }

        .social {
            margin-bottom: 20px;
        }

        .bgc {
            padding-top: 10px;
            padding-bottom: 5px;
            background-color: #0d3056ff;
        }

        /* Alert container */
        .alert-container {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1050;
            width: 90%;
            max-width: 500px;
        }
        

        /* Ensure main content area is scrollable */
        .main-content-area {
            flex: 1;
            overflow-y: auto; /* Allow content to scroll if needed */
            padding-bottom: 20px; /* Add some spacing above footer */
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <!-- Custom Seller Navbar - matching admin style -->
        <nav class="navbar seller-navbar">
            <div class="seller-navbar-top">
                <div class="seller-navbar-logo">
                    <a href="/"><img src="{{ url_for('static', filename='images/logo5.png') }}" class="header-image" alt="Company Logo"></a>
                </div>
                
                <div class="seller-navbar-actions">
                    <span>
                        Hi, <strong>{{ session.get('user_name', 'Seller') }}</strong>
                        <span class="role-badge">SELLER</span>
                    </span>
                    <a href="{{ url_for('seller_dashboard') }}">Dashboard</a>
                    <a href="{{ url_for('logout') }}">Logout</a>
                </div>
            </div>
        </nav>

        <!-- Alert container -->
        <div class="alert-container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
        </div>

        <div class="content-container">
            <div class="container-fluid mt-3 main-content-area">
                <div class="row">
                    <!-- Sidebar -->
                    <div class="col-md-2 bg-dark text-white p-3">


                        <h4 class="text-center mb-4">{{ session.user_name }}</h4>
                        <div class="d-flex flex-column">
                            <button class="sidebar-btn active" data-target="add-product">
                                <i class="fas fa-plus-circle"></i>
                                Add Product
                            </button>
                            <button class="sidebar-btn" data-target="my-products">
                                <i class="fas fa-box"></i>
                                My Products
                            </button>
                            <button class="sidebar-btn" data-target="customers">
                                <i class="fas fa-users"></i>
                                Customers
                            </button>
                            <button class="sidebar-btn" data-target="orders">
                                <i class="fas fa-shopping-cart"></i>
                                Orders
                            </button>
                            <button class="sidebar-btn" data-target="profile">
                                <i class="fas fa-user-cog"></i>
                                Profile
                            </button>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="col-md-10">

                        <!-- Add Product Section -->
                        <div id="add-product" class="content-section active mb-5">
                            <h2 class="mb-4"><i class="fas fa-plus-circle me-2"></i>Add New Product</h2>
                            <div class="card">
                                <div class="card-body">
                                    <form method="POST" action="{{ url_for('add_product') }}" enctype="multipart/form-data">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label">Product Name*</label>
                                                    <input type="text" class="form-control" name="title" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Price (₹)*</label>
                                                    <input type="number" step="0.01" min="0" class="form-control" name="price" required>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Discount (%)</label>
                                                    <input type="number" step="0.01" min="0" max="100" class="form-control" name="discount" value="0">
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Compare Price (₹)</label>
                                                    <input type="number" step="0.01" min="0" class="form-control" name="compare_price">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="stock_quantity" class="form-label">Stock Quantity*</label>
                                                    <input type="number" class="form-control" id="stock_quantity" name="stock_quantity" min="0" required>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                <label class="form-label">Category*</label>
                                                <select class="form-select" name="category" id="category" required>
                                                    <option value="">Select Category</option>
                                                    <option value="food-and-health">Food and Health</option>
                                                    <option value="shop-by-care">Shop by Care</option>
                                                    <option value="shop-by-concern">Shop by Concern</option>
                                                    <option value="kids-special">Kids Special</option>
                                                    <option value="hair-care">Hair Care</option>
                                                    <option value="skin-care">Skin Care</option>
                                                    <option value="weight-management">Weight Management</option>
                                                    <option value="tea-blends">Tea Blends</option>
                                                </select>
                                            </div>

                                            <div class="mb-3" id="subcategory-wrapper" style="display: none;">
                                                <label class="form-label">Sub Category</label>
                                                <select class="form-select" name="sub_category" id="sub_category">
                                                    <option value="">Select Subcategory</option>
                                                </select>
                                            </div>

                                                <div class="mb-3">
                                                    <label class="form-label">Product Image*</label>
                                                    <input type="file" class="form-control" name="image" accept="image/*" required>
                                                    <small class="text-muted">Allowed formats: JPG, PNG, GIF</small>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Description*</label>
                                            <textarea class="form-control" name="description" rows="3" required></textarea>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Tags (comma separated)</label>
                                            <input type="text" class="form-control" name="tags" placeholder="e.g., organic, vegan, gluten-free">
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Benefits (comma separated)</label>
                                            <input type="text" class="form-control" name="benefits" placeholder="e.g., improves digestion, boosts immunity">
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">Submit for Approval</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <!-- My Products Section -->
                        <div id="my-products" class="content-section mb-5">
                            <h2 class="mb-4"><i class="fas fa-box me-2"></i>My Products</h2>
                            
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>Image</th>
                                            <th>Name</th>
                                            <th>Category</th>
                                            <th>Sub Category</th>

                                            <th>Stock</th>
                                            <th>Price (₹)</th>
                                            <th>Discounted (₹)</th>
                                            <th>Discount (%)</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for product in products %}
                                        {% set stock_qty = product.get('stock_quantity', 0) %}
                                        <tr class="{% if stock_qty == 0 %}table-danger{% elif stock_qty < 5 %}table-warning{% endif %}">
                                            <td>
                                                {% if product.image %}
                                                <img src="{{ url_for('static', filename='images/' + product.image) }}" width="50" height="50" class="img-thumbnail">
                                                {% else %}
                                                <span class="text-muted">No image</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ product.title }}</td>
                                            <td>{{ product.category }}</td>

                                            <td>{{ product.sub_category or '—' }}</td>

                                            <td>
                                                {% if stock_qty == 0 %}
                                                    <span class="badge bg-danger">Out of Stock</span>
                                                {% elif stock_qty < 5 %}
                                                    <span class="badge bg-warning">Low Stock ({{ stock_qty }})</span>
                                                {% else %}
                                                    <span class="badge bg-success">{{ stock_qty }}</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ "%.2f"|format(product.price) }}</td>
                                            <td>
                                                {% if product.get('calculated_discounted_price') %}
                                                    {{ "%.2f"|format(product.calculated_discounted_price) }}
                                                {% elif product.get('discounted_price') %}
                                                    {{ "%.2f"|format(product.discounted_price) }}
                                                {% else %}
                                                    {{ "%.2f"|format(product.price * (1 - (product.get('discount', 0) / 100))) }}
                                                {% endif %}
                                            </td>
                                            <td>{{ product.get('discount', 0) }}%</td>
                                            <td>
                                                <span class="badge bg-{% if product.status == 'approved' %}success{% elif product.status == 'rejected' %}danger{% else %}warning{% endif %}">
                                                    {{ product.status|title }}
                                                </span>
                                                {% if product.get('rejection_reason') %}
                                                    <br><small class="text-muted">{{ product.rejection_reason }}</small>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <a href="{{ url_for('edit_product', product_id=product.id) }}" class="btn btn-sm btn-primary">Edit</a>
                                                <form method="POST" action="{{ url_for('delete_product', product_id=product.id) }}" class="d-inline">
                                                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this product?')">Delete</button>
                                                </form>
                                            </td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td colspan="8" class="text-center">No products found</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Customers Section -->
                        <div id="customers" class="content-section mb-5">
                            <h2 class="mb-4"><i class="fas fa-users me-2"></i>Customers Who Bought My Products</h2>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>Customer</th>
                                            <th>Product</th>
                                            <th>Quantity</th>
                                            <th>Price (₹)</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for customer in customers %}
                                        <tr>
                                            <td>
                                                <strong>{{ customer.user_id }}</strong><br>
                                                <strong>{{ customer.name }}</strong><br>
                                                <small>{{ customer.email }}</small><br>
                                                <small>{{ customer.mobile or 'N/A' }}</small>
                                            </td>
                                            <td>{{ customer.product_title }}</td>
                                            <td>{{ customer.quantity }}</td>
                                            <td>{{ "%.2f"|format(customer.sold_price) }}</td>
                                            <td>{{ customer.order_date.strftime('%d-%m-%Y') }}</td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td colspan="5" class="text-center">No customer orders yet</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                  
                        <!-- Orders Section -->
                        <div id="orders" class="content-section mb-5">
                            <h2 class="mb-4"><i class="fas fa-shopping-cart me-2"></i>Orders Awaiting Approval</h2>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>Order ID</th>
                                            <th>Customer</th>
                                            <th>Items</th>
                                            <th>Total (₹)</th>
                                            <th>Payment Method</th>
                                            <th>Status</th>
                                            <th>Tracking Number</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for order in seller_orders %}
                                            {% if order.status == 'paid' %}
                                            <tr>
                                                <td>{{ order.id }}</td>
                                                <td>
                                                {{ order.customer_name }}<br>
                                                {{ order.customer_email }}<br>
                                                <small>{{ order.shipping_address }}</small><br>
                                                <small>{{ order.order_date.strftime('%d-%m-%Y') }}</small>
                                                </td>
                                                <td>{{ order.items }}</td>
                                                <td>{{ "%.2f"|format(order.total_amount) }}</td>
                                                <td>{{ order.payment_method|capitalize }}</td>
                                                <td><span class="badge bg-warning">{{ order.status|capitalize }}</span></td>
                                                <td>
                                                    {{ order.tracking_number if order.tracking_number else '-' }}
                                                </td>

                                                <td>
                                                    {% if order.status == 'paid' %}
                                                        <form method="POST" action="{{ url_for('confirm_shipment', order_id=order.id) }}">
                                                            <button type="submit" class="btn btn-sm btn-success">Approve</button>
                                                        </form>
                                                        {% elif order.status == 'confirmed' %}
                                                        <form method="POST" action="{{ url_for('ship_order', order_id=order.id) }}">
                                                            <button type="submit" class="btn btn-sm btn-primary">Ship</button>
                                                        </form>
                                                        {% elif order.status == 'shipped' %}
                                                        <span class="text-success">Shipped</span>
                                                    {% endif %}

                                                </td>
                                            </tr>
                                            {% endif %}
                                        {% else %}
                                        <tr>
                                            <td colspan="6" class="text-center">No pending orders</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Profile Section -->
                        <div id="profile" class="content-section">
                            <h2 class="mb-4"><i class="fas fa-user-cog me-2"></i>Seller Profile</h2>
                            <div class="card">
                                <div class="card-body">
                                    {% if seller_profile %}
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h5>Company Information</h5>
                                            <p><strong>Company Name:</strong> {{ seller_profile.company_name }}</p>
                                            <p><strong>PAN Number:</strong> {{ seller_profile.pan_number }}</p>
                                            <p><strong>GST Number:</strong> {{ seller_profile.gst_number or 'N/A' }}</p>
                                        </div>
                                        <div class="col-md-6">
                                            <h5>Contact Information</h5>
                                            <p><strong>Mobile:</strong> {{ seller_profile.mobile }}</p>
                                            <p><strong>Address:</strong> {{ seller_profile.address }}</p>
                                            <h5 class="mt-3">Bank Details</h5>
                                            <p><strong>Account Number:</strong> {{ seller_profile.bank_account }}</p>
                                            <p><strong>IFSC Code:</strong> {{ seller_profile.ifsc_code }}</p>
                                        </div>
                                    </div>
                                    <a href="{{ url_for('edit_seller_profile') }}" class="btn btn-primary mt-3">Edit Profile</a>
                                    {% else %}
                                    <div class="alert alert-warning">
                                        <h5>Profile Incomplete</h5>
                                        <p>Please complete your seller profile to start selling products.</p>
                                        <a href="{{ url_for('edit_seller_profile') }}" class="btn btn-warning">Complete Profile</a>
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer - Fixed at bottom -->
    <footer>
        <div class="container2 text-center">
            <h2>Subscribe to our channels</h2><hr>
            <div class="social d-flex justify-content-center gap-3">
                <a href="https://instagram.com/aarogyanutrimix" style="margin-top:20px"><img src="https://cdn-icons-png.flaticon.com/512/2111/2111463.png" width="24" alt="Instagram"></a>
                <a href="https://www.youtube.com/@AarogyaNutriMix" style="margin-top:20px"><img src="https://cdn-icons-png.flaticon.com/512/1384/1384060.png" width="24" alt="YouTube"></a>
            </div>
        </div>
        
        <div class="footer__copyright caption">
            <small class="copyright__content">© 2025, <a href="/" title="">Aarogya Nutri Mix</a></small>
            <small class="copyright__content"><a target="_blank" rel="nofollow" href="#"> </a></small>
            <ul class="policies list-unstyled">
                <li><small class="copyright__content"><a href="#">Refund policy</a></small></li>
                <li><small class="copyright__content"><a href="#">Privacy policy</a></small></li>
                <li><small class="copyright__content"><a href="#">Terms of service</a></small></li>
                <li><small class="copyright__content"><a href="#">Shipping policy</a></small></li>
                <li><small class="copyright__content"><a href="#">Contact information</a></small></li>
            </ul>
        </div>
    </footer>

    <!-- Make sure jQuery is loaded -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
    // Sidebar navigation functionality
    document.addEventListener('DOMContentLoaded', function() {
        const sidebarButtons = document.querySelectorAll('.sidebar-btn');
        const contentSections = document.querySelectorAll('.content-section');

        sidebarButtons.forEach(button => {
            button.addEventListener('click', function() {
                const targetId = this.getAttribute('data-target');
                
                // Remove active class from all buttons
                sidebarButtons.forEach(btn => btn.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Hide all content sections
                contentSections.forEach(section => section.classList.remove('active'));
                
                // Show target section
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            });
        });
    });

    // Category and subcategory functionality
    const categoryMap = {
        "food-and-health": [
            "Milk Malts",
            "Amla-Human-Sanjeevani",
            "Sprouted Flours",
            "Cooking Essentials",
            "Kaaram Podis",
            "Basic Health"
        ],
        "shop-by-care": [
            "Pregnancy Care",
            "Diabetic Care",
            "Baby Care"
        ],
        "shop-by-concern": [
            "Iron Deficiency",
            "B-Complex Deficiency",
            "Irregular Periods",
            "Constipation",
            "Bones Strength",
            "Immunity Booster",
            "Cold and Cough"
        ],
        // Standalone categories
        "kids-special": [],
        "hair-care": [],
        "skin-care": [],
        "weight-management": [],
        "tea-blends": []
    };

    document.addEventListener("DOMContentLoaded", function () {
        const categorySelect = document.getElementById("category");
        const subcategorySelect = document.getElementById("sub_category");
        const subcategoryWrapper = document.getElementById("subcategory-wrapper");

        if (categorySelect) {
            categorySelect.addEventListener("change", function () {
                const selectedCategory = this.value;
                const subcategories = categoryMap[selectedCategory] || [];

                subcategorySelect.innerHTML = '<option value="">Select Subcategory</option>';

                if (subcategories.length > 0) {
                    subcategoryWrapper.style.display = 'block';
                    subcategories.forEach(sub => {
                        const option = document.createElement("option");
                        option.value = slugify(sub);
                        option.textContent = sub;
                        subcategorySelect.appendChild(option);
                    });
                } else {
                    subcategoryWrapper.style.display = 'none';
                    subcategorySelect.value = '';
                }
            });
        }
    });
    // Simple slugify function for the frontend
        function slugify(text) {
            return text.toLowerCase()
                .replace(/[^\w\s-]/g, '') // Remove non-word chars
                .replace(/\s+/g, '-')     // Replace spaces with -
                .replace(/--+/g, '-')      // Replace multiple - with single -
                .trim();                   // Trim leading/trailing -
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Auto-dismiss alerts after 5 seconds
        $(document).ready(function() {
            setTimeout(function() {
                $('.alert').alert('close');
            }, 5000);
        });
    </script>

</body>
</html>